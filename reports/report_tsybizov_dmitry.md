# Отчет о выполненной работе над проектом Smart Spend

**Автор:** Цыбизов Дмитрий  
**Email:** tsybizov.da@phystech.edu, dts97@yandex.ru

---

## 1. Моя роль в проекте

В рамках командной разработки проекта Smart Spend я занимал позицию **Software Engineer** и отвечал за реализацию ключевых компонентов системы, связанных с безопасностью, аутентификацией и тестированием. Моя работа была сфокусирована на создании базовой инфраструктуры приложения, которая стала фундаментом для дальнейшей разработки другими участниками команды.

Основные направления моей работы:
- Разработка модуля аутентификации и авторизации
- Создание инфраструктуры для тестирования
- Реализация функциональности экспорта данных
- Работа с миграциями базы данных

---

## 2. Перечень задач и описание работы над ними

### 2.1. Разработка модуля аутентификации

**Задача:** Создать полнофункциональную систему аутентификации пользователей с использованием JWT токенов.

**Описание работы:**

Модуль аутентификации стал одной из первых и наиболее важных частей проекта, так как без него невозможно было бы обеспечить безопасность остальных компонентов системы. Я начал с проектирования архитектуры модуля, разделив его на несколько слоев: модели данных, репозиторий для работы с БД, сервис с бизнес-логикой и роутер с API эндпоинтами.

На этапе проектирования я изучил лучшие практики работы с JWT токенами и решил реализовать систему с двумя типами токенов: access токенами для авторизации запросов и refresh токенами для безопасного обновления сессии. Это потребовало создания отдельной таблицы в базе данных для хранения refresh токенов.

При реализации я столкнулся с необходимостью правильно настроить работу с асинхронными операциями в SQLAlchemy, что было новым опытом для меня. Также пришлось разобраться с библиотеками `python-jose` для работы с JWT и `passlib` для безопасного хэширования паролей.

Результатом работы стал модуль, включающий:
- Эндпоинты для регистрации и авторизации пользователей
- Систему генерации и валидации JWT токенов
- Механизм обновления токенов через refresh токены
- Функцию получения текущего авторизованного пользователя
- Безопасное хранение паролей с использованием bcrypt

### 2.2. Создание инфраструктуры тестирования

**Задача:** Настроить систему тестирования приложения и написать первые тесты для модуля аутентификации.

**Описание работы:**

Понимая важность тестирования для качества кода, я взял на себя задачу создания инфраструктуры для тестирования. Это включало настройку pytest, создание базовых фикстур для работы с тестовой базой данных и HTTP клиентом.

Самым сложным моментом было настройка асинхронных тестов, так как FastAPI использует асинхронные операции, и тесты должны были это учитывать. Мне пришлось изучить `pytest-asyncio` и правильно настроить фикстуры для работы с асинхронными функциями.

Я написал комплексные тесты для модуля аутентификации, покрывающие:
- Тесты роутера (проверка всех эндпоинтов API)
- Тесты сервиса (проверка бизнес-логики)
- Тесты функций безопасности (хэширование паролей, работа с токенами)

При написании тестов я использовал мокирование для изоляции тестируемых компонентов от зависимостей, что позволило создавать быстрые и надежные тесты.

### 2.3. Реализация экспорта транзакций в CSV

**Задача:** Добавить функциональность экспорта транзакций пользователя в CSV формат с возможностью фильтрации.

**Описание работы:**

Эта задача была интересна тем, что требовала работы с файлами и форматом данных. Мне нужно было реализовать экспорт с поддержкой фильтрации по категориям и датам, что потребовало интеграции с существующей системой фильтров транзакций.

Основные вызовы:
- Правильное форматирование CSV с поддержкой кириллицы (для корректного отображения в Excel)
- Эффективная работа с большими объемами данных
- Корректная настройка HTTP заголовков для скачивания файла

Я использовал стандартную библиотеку Python `csv` и `io.StringIO` для работы с данными в памяти, что позволило избежать создания временных файлов на диске. Также добавил BOM (Byte Order Mark) для UTF-8, чтобы файлы корректно открывались в Excel.

Параллельно с реализацией функциональности я написал полный набор тестов, проверяющих все сценарии использования экспорта, включая различные комбинации фильтров и обработку ошибок.

### 2.4. Функциональность смены пароля

**Задача:** Реализовать эндпоинт для безопасной смены пароля пользователя.

**Описание работы:**

Это была относительно простая, но важная задача с точки зрения безопасности. Мне нужно было обеспечить проверку текущего пароля перед установкой нового, что является стандартной практикой безопасности.

Реализация включала создание нового эндпоинта, схемы данных для валидации входных параметров и метода в сервисе пользователей для обновления пароля. Важно было правильно обработать случай, когда пользователь вводит неверный текущий пароль.

### 2.5. Работа с миграциями базы данных

**Задача:** Создать миграции для поддержки таблиц групп и участников групп.

**Описание работы:**

Работа с миграциями Alembic была необходима для поддержки функциональности групп, которую разрабатывали другие участники команды. Мне нужно было создать миграцию, которая правильно определяла структуру таблиц и связи между ними.

Это потребовало изучения синтаксиса Alembic и понимания того, как правильно описывать изменения схемы базы данных. Также пришлось обновить конфигурацию Alembic для корректной работы с новыми моделями.

---

## 3. Использованные технологии и инструменты

В ходе работы над проектом я активно использовал следующие технологии и инструменты:

### Backend-разработка:
- **FastAPI** - современный веб-фреймворк для создания API. Изучил его возможности по работе с асинхронными операциями, dependency injection и автоматической генерации документации.
- **SQLAlchemy** - ORM для работы с базой данных. Освоил работу с асинхронными сессиями и создание моделей данных.
- **Alembic** - инструмент для миграций базы данных. Научился создавать и применять миграции для изменения схемы БД.

### Безопасность:
- **python-jose** - библиотека для работы с JWT токенами. Изучил процесс создания, подписи и валидации токенов.
- **passlib** - библиотека для хэширования паролей. Использовал bcrypt для безопасного хранения паролей.

### Тестирование:
- **pytest** - фреймворк для написания тестов. Настроил конфигурацию и создал структуру тестов.
- **pytest-asyncio** - плагин для поддержки асинхронных тестов. Научился правильно работать с async/await в тестах.
- **httpx** - HTTP клиент для тестирования API эндпоинтов.
- **pytest-mock** - инструмент для мокирования зависимостей в тестах.

### Работа с данными:
- **csv** (стандартная библиотека Python) - для экспорта данных в CSV формат.
- **io.StringIO** - для работы с данными в памяти при экспорте.

### Инструменты разработки:
- **Git** - система контроля версий для совместной работы над проектом.
- **Poetry** - менеджер зависимостей Python.
- **Docker** - для контейнеризации приложения (изучал в контексте проекта).

---

## 4. Саморефлексия

### 4.1. Мои достижения

Основные достижения в работе над проектом:

1. **Создание модуля аутентификации** - разработал полнофункциональную систему авторизации, которая стала основой для безопасности всего приложения. Это позволило команде сразу работать с защищенными эндпоинтами.

2. **Освоение новых технологий** - получил практический опыт работы с FastAPI, асинхронным программированием в Python, JWT токенами и системой миграций Alembic. До проекта у меня был ограниченный опыт в этих областях.

3. **Инфраструктура тестирования** - создал систему тестирования и написал тесты для модуля аутентификации. Это помогло лучше понять важность тестирования в разработке.

4. **Функциональность экспорта** - реализовал экспорт транзакций в CSV с фильтрацией, что потребовало работы с файлами и кодировками.

### 4.2. Трудности, с которыми столкнулся

Основные сложности, которые пришлось преодолеть:

1. **Асинхронное программирование** - изначально было непросто разобраться с async/await в Python, особенно при работе с SQLAlchemy и написании асинхронных тестов. Потребовалось время на изучение документации и практику.

2. **Настройка тестов** - создание правильной конфигурации для тестирования асинхронного приложения оказалось сложнее, чем ожидалось. Пришлось разобраться с настройкой тестовой БД и фикстур.

3. **Работа с JWT токенами** - реализация системы с refresh токенами потребовала тщательного планирования и понимания механизмов безопасности.

4. **Интеграция с чужим кодом** - при реализации экспорта нужно было работать с кодом других участников команды, что требовало понимания их архитектурных решений.

Все трудности были решены через изучение документации, эксперименты и помощь команды.

### 4.3. Общие впечатления от командной работы

Работа в команде была полезным опытом. Четкое разделение задач позволило каждому сфокусироваться на своей области. Команда всегда помогала при возникновении вопросов, особенно полезными были обсуждения архитектуры и code review.

Работа через Git и Pull Requests научила правильному процессу совместной разработки. Видя код других участников, я мог изучать разные подходы к решению задач.

Иногда возникали сложности с синхронизацией изменений и согласованием архитектурных решений, но это научило важности коммуникации и планирования.

В целом, проект дал мне практический опыт разработки реального приложения, расширил технические навыки и показал важность командной работы.
